global
        log /dev/log    local0
        log /dev/log    local1 notice
        chroot /var/lib/haproxy
        user haproxy
        group haproxy
        daemon
        maxconn 1024

defaults
        log     global
        mode    http
        option  httplog
        option  dontlognull
        timeout http-request 5s
        timeout connect 5s
        timeout server 10s
        timeout client 30s

#foreach ($app in ${body.apps})  
#foreach ($servicePort in $app.ports())
frontend frontend::${app.id}::${servicePort}
    bind *:${servicePort}
    acl has::${app.id}::${servicePort} ${app.acl}
    use_backend servers::${app.id}::${servicePort} if has::${app.id}::${servicePort}
	#end
#end


#foreach ($app in ${body.apps})  
#foreach ($servicePort in $app.ports())
backend servers::${app.id}::${servicePort}
    balance roundrobin
    option httpclose
    option forwardfor
#foreach ($instance in $app.instances($servicePort))
    server ${app.id}-${foreach.count} ${instance.host}:${instance.port} check
#end
#end
#end

